[https://bbiguduk.gitbook.io/swift/language-guide-1/opaque-types](https://bbiguduk.gitbook.io/swift/language-guide-1/opaque-types)

[https://zeddios.tistory.com/1366](https://zeddios.tistory.com/1366)

## Opaque 타입 (Swift 5.1+, iOS 13+)

```Swift
struct SwiftUIView: View {
		var body: some View
}
```

불투명하다는 뜻!

> [!important] 사실 **인스턴스 생성 시 내부 정보를 노출하기에 반환 타입을 명시하게 되고 공용 인터페이스의 일부가 아닌 타입이 누출**됩니다.
> 
> **특정 프로토콜을 사용하는 모듈 외부의 코드는 변환에 대한 구현 세부 사항들을 설명할 필요는 사실 없는데 이에 위배**되게 됩니다.
> 
> > 이를 Opaque Type으로 해결해볼 수 있습니다.

**함수 구현이 함수를 호출하는 코드에서 추상화된 방식으로 리턴 값의 유형을 선택할 수 있게 됩니다.**

### 사용가능한 곳

- 함수의 리턴타입
- stored property 타입
- computed property 타입
- subscripts 함수 파라미터 타입 (Swift 5.7+)

## Opaque 타입 사용예시 - 함수

```Swift
func makeArray() -> some Collection {
		return [1, 2, 3, 4]
}
```

Generic과는 반대로 동작한다!!

무엇이 반대인것?

- 내부가 추상적으로 작성되지 않음
- 내부에서 구체타입을 확실히 알 수 있음
- 호출부에서 Collection 프로토콜을 준수하는 타입인것만 알려줌
- Generic에서는 호출시 구체타입을 넣어야하기때문에 반환타입도 명확히 알려줌

### Generic

- 구현부 - 추상화하여 작성
- 호출부 - 구체적인 타입 지정 (타입을 알 수 있음)

### Opaque

- 구현부 - 구체적인 타입 지정 (타입을 알 수 있음)
- 호출부 - 추상화해 작성

  

이러한 반대되는 특징때문에 Opaque 타입은 **“역 제네릭 타입(reverse generic type)”**으로 불림

또 이러한 특성 때문에 **“Opaque타입은 리턴 타입의 정보를 숨길 수 있다”** 고 말함

  

## Opaque 타입 사용시 제약

### 함수에서 리턴할때는 프로토콜을 준수하는 단 하나의 구체타입을 리턴해야한다.

```Swift
struct 오버워치: TestProtocol {}
struct 롤: TestProtocol {}
// 컴파일 에러
func somethings() -> some TestProtocol {
    let 재밌다 = true
    if 재밌다 { return 롤() }
    
    return 오버워치()
}
// 정상 작동
func somethings() -> some TestProtocol {
    return 오버워치()
}
```

컴파일 에러나는 코드에서 `some` 키워드만 뺀다면 문제없이 잘 돌아간다.

제목에서도 말했듯이 로직 내부에서 리턴시 단 하나의 구체타입만 리턴해야한다.

- **Opaque Type**
    - 하나의 특정 구체 타입을 참조하지만 함수 호출자는 어떤 타입인지 볼 수 없음
- **Protocol Type**
    - 프로토콜을 준수하는 모든 타입을 참조할 수 있음

  

그렇다면 Protocol Type으로만 사용하는것이 유연하고 더 좋은거 같은데?

## Opaque Type vs Protocol Type

- Opaque Type
    - 하나의 특정타입을 참조하지만, 함수 호출자는 타입을 확인할 수 없다.
    - `==` 메서드를 통해 리턴값 비교 가능 (기본 타입의 ID를 유지함)
- Protocol Type
    - 프로토콜 타입은 프로토콜을 준수하는 모든 타입을 참조할 수 있다.
    - `==` 메서드를 통해 리턴값을 비교할 수 없음 (포함되지 않았음, 그리고 기본타입의 ID를 유지하지 않음)