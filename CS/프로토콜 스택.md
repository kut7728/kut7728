# 개요

- 인터넷에서의 통신은 정보를 담은 ‘패킷’의 교환으로 이루어짐
- 패킷의 내용이 점점 커지면서 규약이 필요해짐
- 따라서 등장한 것이 네트워킹의 과정을 표준화한 `TCP/IP 프로토콜 스택`

> [!important]
> 
> > 참고자료
> 
> [https://haeunyah.tistory.com/85](https://haeunyah.tistory.com/85)

  

# 프로토콜 스택

## TCP/IP의 4계층

- 실제 네트워크 작동 방식으로 사용

> [!important] **TCP (Transmission Control Protocol)**
> 
> - Transport Layer 간의 통신을 가능하게 해주는 규약
> 
> **IP (Internet Protocol)**
> 
> - Network Layer 간의 통신을 가능하게 해주는 규약
> 
>   
> 
> **이 두개의 규약을 합쳐서 → TCP/IP 프로토콜 스택**

  

## OSI-7모델의 7계층

- 통신의 복잡한 과정을 돕기위한 교육적 혹은 개념적인 모델
- Open System Interconnection - 개방형 시스템 상호연결

  

## 구조

![[Attachments/img1.daumcdn 3.png|img1.daumcdn 3.png]]

1. ==**Application (OSI -7: Application, Presentation, Session Layer)**==
    - **"데이터를 잘 전달하기 위해 전달 방법을 결정하고, 데이터를 하나의 통일된 방법으로 정제하는 과정"**
    - 웹 브라우징, 파일 전송, 이메일 등 애플리케이션에서 사용되는 프로토콜 (HTTP, FTP, DNS 등)
        - HTTP/S : 웹 브라우징에 활용되는 프로토콜
        - FTP: File Transfer (파일 전달)에 활용되는 프로토콜
        - SMTP: 이메일 발송에 활용되는 프로토콜
    - 데이터가 생성되면, 데이터를 실제로 전송하는 TCP/UDP 세션이 생성된다
2. ==**Transport (OSI -7: Transport Layer)**==
    
    - 데이터를 받아야 할 상대를 정확히 찾아주는 역할을 하며, 실제로 잘 도달하는지 확인한다.
    - 이 모든 과정을 요약하면 "**통신의 신뢰성을 보장하는 역할**"이라고도 할 수 있다. 
    - 사용되는 프로토콜은 UDP 와 TCP 이다
        - TCP를 사용하면 3-way handshaking을 사용하기 때문에 신뢰성이 보장되고 양방향 통신
        - UDP의 경우 커넥션을 맺는 과정 없이 데이터만 보내기 때문에 신뢰성이 보장되지 않지만 속도가 빠르다, 일방향 통신
    - 프로세스 간의 데이터 전송을 담당하기 때문에 **포트 번호**를 관리한다.
    
    > [!important]
    > 
    > > Transport Layer의 대표적인 역할
    > 
    > 1. **Segmentation:**
    >     
    >     Application Layer 로부터 전달받은 데이터를 작은 단위(Segment)로 나누는 작업이다. 이 때, 각 Segment 에 소스(발신자)와 목적지의 포트 번호, 데이터의 시퀀스 번호(패킷의 순서 명시), Checksum 을 담는다.
    >     
    > 2. **Error Control:**
    >     
    >     수신자가 패킷 조각을 합쳐 하나의 데이터로 구성할 때, 유실되었거나 데이터가 손상된 패킷이 생길 수 있다. 이를 확인할 수 있도록 해주는 것이 바로 Segment 의 Checksum 이다. 수신자는 Checksum 을 활용해 데이터가 유실되거나 망가졌는지 확인하여, 만약 그렇다면 해당 부분을 다시 보내주도록 요청한다.
    >     
    > 3. **Flow Control:**
    >     
    >     데이터가 전송되는 양을 컨트롤하는 작업이다. 컴퓨터, 모바일 등 각 장치별 데이터를 프로세싱하는 속도가 다를 수 있다. 어떤 장치는 하나의 파일을 다운받는데 10Mbps 의 속도를, 어떤 장치는 100Mbps 의 속도를 갖게 된다. 이 때, 서로 데이터를 전송하는 속도를 중간에서 조절하지 않는다면 장치가 감당할 수 있는 것 이상의 데이터가 들어와 오류가 발생할 수 있다.
    >     
    
3. ==**Internet (OSI -7: Network Layer)**==
    - 다른 네트워크에 위치한 컴퓨터간의 패킷 전송을 담당
    - Network Layer 는 Transport Layer 에서 내려주는 **데이터 Segment를 이어받는다.** 그리고 각 Segment 에 발신지와 목적지의 IP 주소를 추가하여 패킷을 구성
    - 패킷은 **IP 주소를 찾아 패킷을 목적지까지 전달해주는 라우터**를 통해 전달된다.
    - 라우터는 여러 복잡한 알고리즘 (OSPF, BGP, IS-IS) 을 통해 최적의 경로를 먼저 찾으며, IP 주소의 앞부분에 해당하는 정확한 네트워크에 먼저 패킷을 전달하고, 이어서 IP 주소의 뒷부분에 해당하는 호스트 (컴퓨터)에 이어서 패킷을 전달한다. 
4. ==**Network Interface (OSI -7: DataLink, Physical Layer)**==
    
    - 전기신호를 통해 두대의 컴퓨터가 서로 신호를 주고 받을 수 있도록 한다
    - 네트워크 매체(이더넷 케이블, 무선 LAN)에서 데이터 전송
    - Network Layer 에서 전달한 데이터를 전기 신호로 변환하면서 데이터 패킷에 데이터 출발지와 목적지의 MAC 주소 (물리적 주소)를 추가하며, 이 추가된 형태의 새로운 데이터를 프레임 (Frame) 이라고 부른다
    
    > [!important] MAC 주소란?
    > 
    > - Media Access Control 의 줄임말로, OSI 2계층 (Data Link Layer) 에서의 통신을 위한 식별자이다.
    > - 네트워크에 접속하는 모든 장비는 MAC 주소를 이용해 서로 통신하게 되기 때문에, 꼭 있어야 하는 주소이다.
    > - MAC 주소는 하드웨어에 고정된 주소이므로 네트워크 구성 요소마다 주소가 다르다
    

  

# HTTP와 HTTPS의 차이점

- HTTP는 웹 브라우저와 웹 서버 간 데이터 전송을 위한 프로토콜로 사용자의 요청과 서버의 응답을 주고 받는다.
- HTTPS는 Secure이 추가된 것으로 데이터 전송을 보호하는 프로토콜이다.
    - TCP/UDP같은 일반적인 인터넷 통신에 보안 레이어를 추가하는 방식
    - SSL/TLS 프로토콜을 사용하여 통신을 암호화 하여 개인정보 유출을 방지한다.
    - https를 구현하기 위해 웹 서버에 설치하는 것이 SSL/TLS인증서
        
        > [!important] **TLS 란?**
        > 
        > - 과거에 SSL이라 불렸음
        > - 서버와의 통신 시 자동으로 URLSession에서 TLS 핸드셰이크 수행
        > - TLS 버전은 기본적으로 OS에 따라 결정되며, iOS 14부터는 TLS 1.3을 기본 지원
        > - **핵심 역할**
        >     1. **기밀성** (Confidentiality): 데이터를 암호화하여 제3자가 내용을 볼 수 없음
        >     2. **무결성** (Integrity): 중간에서 데이터가 조작되지 않았는지 확인
        >     3. **인증성** (Authentication): 클라이언트가 접속하려는 서버가 진짜 맞는지 검증
        
        > [!important] **핸드쉐이크는 또 뭐여**
        > 
        > 1. **Client Hello**
        >     - 클라이언트(iOS 앱)는 서버에 "나 TLS 1.3 쓸게. 암호화 알고리즘은 이런 것들 중 골라봐"라고 보냄
        >     - 세션 ID, 랜덤 숫자 포함
        > 2. **Server Hello**
        >     - 서버는 암호화 방식(예: RSA, ECDHE)을 선택하고,
        >     - 자기 인증서(공개키 포함)를 클라이언트에 전송
        >     - 클라이언트는 이 인증서가 신뢰할 수 있는 기관(CA)에서 발급되었는지 검증
        > 3. **세션 키 교환 (비밀 공유)**
        >     - 클라이언트와 서버는 공개키 암호화/디피-헬만 방식 등을 통해 세션 키(대칭키)를 안전하게 공유
        > 4. **세션 키 기반 통신 시작**
        >     - 이후의 데이터는 이 **공유된 대칭키**를 이용해 AES 등의 알고리즘으로 빠르고 효율적으로 암호화
        
    - 사용자가 HTTPS에 접속하면 서버에서 인증서를 보내고 인증서가 유효하다면 신뢰할 수 있다고 판단한다.
    - 안전한 통신을 위해 암호화 키를 교환하며 모든 데이터를 암호화하여 전송한다.

  

# iOS에서의 네트워크 통신 방법

> [!important]
> 
> > 예상 답변
> 
> iOS에서 네트워크 통신을 구현할 때는 주로 URLSession을 사용합니다.
> 
> 가장 기본적인 형태는 URLSession.shared로 간단한 GET 요청을 보내는 것이고, 보다 복잡한 요구사항이 있을 경우 URLRequest를 사용해서 HTTP 메서드, 헤더, Body 등을 커스터마이징할 수 있습니다.
> 
> 또한 JSON 데이터를 주고받는 경우에는 Codable 프로토콜을 활용하여 모델과의 변환을 자동화합니다. 예를 들어, 서버에서 받아온 데이터를 JSONDecoder로 디코딩해서 앱 내 모델로 사용할 수 있습니다

## 보안통신 방법

- Apple은 ATS(App Transport Security)라는 네트워킹 기능이 개인 정보 보호 및 데이터 무결성을 향상시킨다.
    - iOS 9 이상부터 적용된 보안 정책
    - 비암호화된 HTTP 요청 기본 차단
    - 최소 TLS 1.2 이상 사용 강제
    - 필요시 Info.plist에서 도메인 단위로 예외 설정 가능 (지양해야 함)